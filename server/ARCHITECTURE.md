# AI é¡µé¢ç”Ÿæˆå™¨ - ä¼ä¸šçº§æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: 2.1 (Enterprise - æ¶æ„è¯„å®¡ä¿®è®¢ç‰ˆ)  
> **çŠ¶æ€**: å·²æ‰¹å‡†ï¼Œè¿›å…¥å¼€å‘é˜¶æ®µ  
> **åŸºäº**: Google Prompt Engineering Guide (2025)  
> **è¯„å®¡è¯„çº§**: A- (æ¶æ„æ·±åº¦) / A (å¯è¡Œæ€§) / B+ (ä¼ä¸šçº§ç¨‹åº¦)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

ä» **Demo çº§** æå‡åˆ° **Enterprise çº§**ï¼Œæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

- **å¯é æ€§**: é”™è¯¯è‡ªåŠ¨æ¢å¤ï¼Œä¸å´©æºƒ
- **å¯æµ‹é‡**: æœ‰é‡åŒ–è¯„ä¼°ä½“ç³»
- **å¯æ‰©å±•**: ç‰©æ–™åº“å¯æ— é™æ‰©å±•
- **å¯è¿½æº¯**: å®Œæ•´çš„è°ƒè¯•å’Œå®¡è®¡èƒ½åŠ›
- **å¯æ„ŸçŸ¥**: ç”¨æˆ·å®æ—¶çœ‹åˆ°ç”Ÿæˆè¿›åº¦ **(v2.1 æ–°å¢)**

### 1.2 æ ¸å¿ƒåˆ›æ–°

| ç‰¹æ€§     | Demo ç‰ˆ         | Enterprise ç‰ˆ           |
| -------- | --------------- | ----------------------- |
| ç‰©æ–™æ£€ç´¢ | ç¡¬åŒ¹é… (filter) | **è¯­ä¹‰æ£€ç´¢ (RAG)**      |
| æ¨ç†æ–¹å¼ | JSON å†…åµŒ       | **æ€è€ƒ-æ ¼å¼åŒ–åˆ†ç¦»**     |
| é”™è¯¯å¤„ç† | ç›´æ¥å´©æºƒ        | **è‡ªæˆ‘ä¿®æ­£å¾ªç¯**        |
| è´¨é‡ä¿éšœ | äººå·¥æ£€æŸ¥        | **è‡ªåŠ¨åŒ–è¯„ä¼°ç®¡é“**      |
| ç”¨æˆ·ä½“éªŒ | æ­»å¯‚ Loading    | **SSE æµå¼ä¼ è¾“** (v2.1) |

### 1.3 æ¶æ„è¯„å®¡ä¿®æ­£ (v2.1 å…³é”®æ›´æ–°)

> âš ï¸ **ä»¥ä¸‹ 3 é¡¹ä¸ºå¿…é¡»å®ç°çš„ä¿®æ­£ï¼Œå¦åˆ™ä¸Šçº¿å°†å‡ºç°ä¸¥é‡é—®é¢˜**

| é—®é¢˜           | é£é™©                          | è§£å†³æ–¹æ¡ˆ                           |
| -------------- | ----------------------------- | ---------------------------------- |
| é•¿å»¶è¿Ÿç­‰å¾…     | ç”¨æˆ·ä»¥ä¸ºç³»ç»ŸæŒ‚äº†ï¼Œé‡å¤è¯·æ±‚    | **SSE æµå¼ä¼ è¾“ `<thinking>` å†…å®¹** |
| è¯­ä¹‰æ£€ç´¢è´¨é‡å·® | "GitHub ä¾§è¾¹æ " åŒ¹é…ä¸åˆ° Grid | **å¢å¼ºç‰©æ–™å…ƒæ•°æ® (usage_context)** |
| æ­£åˆ™è§£æè„†å¼±   | åµŒå¥—æ ‡ç­¾/æˆªæ–­è¾“å‡ºå¯¼è‡´å¤±è´¥     | **é²æ£’å¤šæ ¼å¼ JSON æå–å™¨**         |

---

## 2. æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI é¡µé¢è®¾è®¡å™¨ v2.1                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       ç”Ÿæˆç®¡é“å±‚                           â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  æ„å›¾   â”‚â”€â”€â–¶â”‚  è®¾è®¡   â”‚â”€â”€â–¶â”‚ Schema  â”‚â”€â”€â–¶â”‚  éªŒè¯å™¨   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  åˆ†æ   â”‚   â”‚  ç”Ÿæˆ   â”‚   â”‚  ç”Ÿæˆ   â”‚   â”‚ + ä¿®æ­£å™¨  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚       â”‚             â”‚             â”‚              â”‚       â”‚ â”‚
â”‚  â”‚       â”‚             â”‚             â–¼              â”‚       â”‚ â”‚
â”‚  â”‚       â”‚             â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚       â”‚ â”‚
â”‚  â”‚       â”‚             â”‚        â”‚  RAG    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚       â”‚             â”‚        â”‚ è¯­ä¹‰æ£€ç´¢ â”‚    é‡è¯•å¾ªç¯    â”‚ â”‚
â”‚  â”‚       â”‚             â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â”‚       â”‚             â”‚             â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚             â”‚             â”‚                        â”‚
â”‚          â–¼             â–¼             â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       çŸ¥è¯†å±‚                               â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚   å‘é‡åº“    â”‚  â”‚  æç¤ºè¯     â”‚  â”‚   ç‰©æ–™åº“        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  (LanceDB)  â”‚  â”‚  (æ¨¡æ¿)     â”‚  â”‚  (ç»„ä»¶å…ƒæ•°æ®)   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      å¯è§‚æµ‹æ€§å±‚                            â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  è¯·æ±‚è¿½è¸ª   â”‚  â”‚  è¯„ä¼°ç®¡é“   â”‚  â”‚   é”™è¯¯ç›‘æ§      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ (LangSmith) â”‚  â”‚  (æŒ‡æ ‡)     â”‚  â”‚   (Sentry)      â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 RAG è¯­ä¹‰æ£€ç´¢æ¨¡å—

#### 3.1.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: å½“å‰ `getMaterialContext` å®Œå…¨ä¾èµ– Phase 1 æ¨¡å‹çŒœæµ‹ç»„ä»¶åã€‚

```typescript
// âŒ å½“å‰å®ç°ï¼šç¡¬åŒ¹é…
const materials = allMaterials.filter((m) =>
  suggestedComponents.includes(m.name)
);
```

**é£é™©**:

- ç”¨æˆ·è¯´"é€‰æ—¥æœŸ"ï¼Œæ¨¡å‹å¯èƒ½ä¸çŸ¥é“å« `DatePicker`
- ç‰©æ–™åº“æ–°å¢ 50 ä¸ªç»„ä»¶ï¼Œæ¨¡å‹è®­ç»ƒæ•°æ®ä¸­æ²¡æœ‰

#### 3.1.2 è§£å†³æ–¹æ¡ˆ

```typescript
// âœ… æ”¹è¿›å®ç°ï¼šè¯­ä¹‰æ£€ç´¢
const queryEmbedding = await embed("èƒ½é€‰æ—¥æœŸçš„ä¸œè¥¿");
const results = await vectorDB.search(queryEmbedding, (topK = 5));
// results: [DatePicker(0.92), Calendar(0.87), TimePicker(0.76)]
```

#### 3.1.3 æ¨¡å—ç»“æ„

```
server/rag/
â”œâ”€â”€ embeddings.ts      # Embedding æœåŠ¡å°è£…
â”œâ”€â”€ vectorStore.ts     # LanceDB æ“ä½œ
â”œâ”€â”€ indexer.ts         # ç´¢å¼•æ„å»ºå™¨
â””â”€â”€ retriever.ts       # æ£€ç´¢æ¥å£
```

#### 3.1.4 æ ¸å¿ƒæ¥å£

```typescript
// server/rag/retriever.ts
export interface MaterialRetriever {
  /**
   * åŸºäºç”¨æˆ·éœ€æ±‚è¯­ä¹‰æ£€ç´¢ç‰©æ–™
   * @param query ç”¨æˆ·éœ€æ±‚æ–‡æœ¬
   * @param topK è¿”å›æ•°é‡
   */
  retrieve(query: string, topK?: number): Promise<Material[]>;

  /**
   * æ··åˆæ£€ç´¢ï¼šCore + Semantic
   */
  hybridRetrieve(query: string): Promise<Material[]>;
}
```

#### 3.1.5 æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é‡åµŒå…¥   â”‚ â”€â”€â–¶ [0.12, -0.34, 0.56, ...]
â”‚  (OpenAI)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‘é‡åº“    â”‚ â”€â”€â–¶ æœ€ç›¸ä¼¼çš„ Top-K ç‰©æ–™
â”‚  (LanceDB)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ ¸å¿ƒé›†     +   è¯­ä¹‰å¬å›   â”‚
â”‚ [Page, Grid] + [DatePicker] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
   LLM ä¸Šä¸‹æ–‡
```

---

### 3.2 CoT åˆ†ç¦»æ¨¡å—

#### 3.2.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: æŠŠ `reasoning` æ”¾åœ¨ JSON å†…éƒ¨ï¼Œé™åˆ¶äº†æ¨¡å‹æ€è€ƒèƒ½åŠ›ã€‚

```json
// âŒ å½“å‰ï¼šæ€è€ƒè¢«å›°åœ¨ JSON ç»“æ„ä¸­
{
  "reasoning": "å¸ƒå±€é‡‡ç”¨...",  // æ¨¡å‹è¾¹ç”ŸæˆJSONè¾¹æ€è€ƒ
  "root": { ... }
}
```

**Google æŒ‡å—åŸåˆ™**:

> "Put the answer **after** the reasoning" - CoT Best Practices

#### 3.2.2 è§£å†³æ–¹æ¡ˆ

```xml
<!-- âœ… æ”¹è¿›ï¼šè‡ªç”±æ€è€ƒåŒº + ç»“æ„åŒ–è¾“å‡º -->
<thinking>
è¿™æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œéœ€è¦è€ƒè™‘ï¼š
1. å¸ƒå±€ï¼šå±…ä¸­å¡ç‰‡ï¼Œå¥‘åˆè¡¨å•ç±»é¡µé¢
2. é¢œè‰²ï¼šä¸“ä¸šè“è‰²è°ƒ
3. ç»„ä»¶å±‚æ¬¡ï¼šPage > Container > Form > FormItem...
</thinking>

<json>
{
  "name": "Page",
  "children": [...]
}
</json>
```

#### 3.2.3 è§£æå®ç°

```typescript
// server/utils/tagParser.ts
export function parseTaggedResponse(content: string): {
  thinking: string;
  json: any;
} {
  const thinkingMatch = content.match(/<thinking>([\s\S]*?)<\/thinking>/);
  const jsonMatch = content.match(/<json>([\s\S]*?)<\/json>/);

  return {
    thinking: thinkingMatch?.[1]?.trim() || "",
    json: jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(content),
  };
}
```

#### 3.2.4 Prompt æ¨¡æ¿

```markdown
# é¡µé¢ Schema ç”Ÿæˆ

## è¾“å‡ºæ ¼å¼

1. é¦–å…ˆåœ¨ <thinking> æ ‡ç­¾å†…è¿›è¡Œå¸ƒå±€æ€è€ƒ
2. ç„¶ååœ¨ <json> æ ‡ç­¾å†…è¾“å‡ºæœ€ç»ˆ Schema

ç¤ºä¾‹ï¼š

<thinking>
åˆ†æç”¨æˆ·éœ€æ±‚ï¼šç™»å½•é¡µé¢
- å¸ƒå±€ç­–ç•¥ï¼šå±…ä¸­å¡ç‰‡
- æ ¸å¿ƒç»„ä»¶ï¼šForm, Input, Button
- æ ·å¼é‡ç‚¹ï¼šæ¸…æ™°çš„è¾“å…¥åŒºåŸŸï¼Œé†’ç›®çš„æäº¤æŒ‰é’®
</thinking>

<json>
{
  "name": "Page",
  ...
}
</json>

## ç°åœ¨è¯·å¤„ç†ä»¥ä¸‹éœ€æ±‚ï¼š
```

---

### 3.3 è‡ªæˆ‘ä¿®æ­£å¾ªç¯æ¨¡å—

#### 3.3.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: JSON è§£æå¤±è´¥æˆ–ç»“æ„é”™è¯¯ç›´æ¥å¯¼è‡´ 500ã€‚

**ä¼ä¸šçº§è¦æ±‚**: è‡ªåŠ¨æ¢å¤ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ã€‚

#### 3.3.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       è‡ªæˆ‘ä¿®æ­£å¾ªç¯                            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   ç”Ÿæˆ   â”‚â”€â”€â–¶â”‚   è§£æ   â”‚â”€â”€â–¶â”‚   éªŒè¯   â”‚â”€â”€â–¶â”‚   è¾“å‡º    â”‚â”‚
â”‚  â”‚          â”‚   â”‚  (JSON)  â”‚   â”‚ (Linter) â”‚   â”‚           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â–²              â”‚              â”‚                       â”‚
â”‚       â”‚              â”‚ é”™è¯¯         â”‚ é”™è¯¯                  â”‚
â”‚       â”‚              â–¼              â–¼                       â”‚
â”‚       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚       â”‚         â”‚     é”™è¯¯èšåˆå™¨        â”‚                   â”‚
â”‚       â”‚         â”‚   (æ”¶é›†é”™è¯¯ä¿¡æ¯)       â”‚                   â”‚
â”‚       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                     â”‚                               â”‚
â”‚       â”‚                     â–¼                               â”‚
â”‚       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚       â”‚         â”‚     é‡è¯•å†³ç­–å™¨        â”‚                   â”‚
â”‚       â”‚         â”‚   å°è¯•æ¬¡æ•° < 3 ?      â”‚                   â”‚
â”‚       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                     â”‚ æ˜¯                            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3.3 æ ¸å¿ƒæ¥å£

```typescript
// server/validation/retryLoop.ts
export interface RetryConfig {
  maxAttempts: number; // æœ€å¤§é‡è¯•æ¬¡æ•°
  backoffMs: number; // é‡è¯•é—´éš”
  errorInjection: boolean; // æ˜¯å¦å°†é”™è¯¯æ³¨å…¥ Prompt
}

export async function generateWithRetry<T>(
  generator: () => Promise<string>,
  parser: (content: string) => T,
  validator: (result: T) => ValidationResult,
  config: RetryConfig
): Promise<T>;
```

#### 3.3.4 é”™è¯¯æ³¨å…¥ç­–ç•¥

```typescript
function buildRetryPrompt(originalPrompt: string, error: string): string {
  return `${originalPrompt}

âš ï¸ **ä¸Šæ¬¡ç”Ÿæˆå¤±è´¥**

é”™è¯¯ç±»å‹: ${error}

è¯·ä»”ç»†æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹åé‡æ–°ç”Ÿæˆï¼š
1. JSON æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆæ‹¬å·åŒ¹é…ã€é€—å·ä½¿ç”¨ï¼‰
2. ç»„ä»¶åæ˜¯å¦åœ¨ç‰©æ–™åº“ä¸­
3. å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´ï¼ˆname, childrenï¼‰

ç°åœ¨è¯·é‡æ–°ç”Ÿæˆï¼š`;
}
```

---

### 3.4 SSE æµå¼ä¼ è¾“æ¨¡å— (v2.1 æ–°å¢)

> âš ï¸ **æ¶æ„è¯„å®¡å¿…ä¿®é¡¹ #1**: è§£å†³ 15-30 ç§’çš„"æ­»å¯‚ç­‰å¾…"é—®é¢˜

#### 3.4.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: RAG + CoT + Retry å¯èƒ½å¯¼è‡´ 15-30 ç§’å»¶è¿Ÿï¼Œå‰ç«¯ä¸€ç‰‡æ­»å¯‚ã€‚

**ç”¨æˆ·è¡Œä¸º**: ä»¥ä¸ºç³»ç»ŸæŒ‚äº† â†’ åˆ·æ–°é¡µé¢ â†’ é‡å¤è¯·æ±‚ â†’ åç«¯é›ªå´©

#### 3.4.2 è§£å†³æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SSE æµå¼æ¶æ„                             â”‚
â”‚                                                              â”‚
â”‚  åç«¯                                å‰ç«¯                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ LLM ç”Ÿæˆ â”‚ â”€â”€â”€streamâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ EventSource ç›‘å¬    â”‚â”‚
â”‚  â”‚ <thinking>â”‚                       â”‚                      â”‚â”‚
â”‚  â”‚ æ­£åœ¨åˆ†æ..â”‚                       â”‚ "ğŸ¤” æ­£åœ¨åˆ†æå¸ƒå±€..." â”‚â”‚
â”‚  â”‚ </thinking>                       â”‚ "ğŸ“ å†³å®šå±…ä¸­å¡ç‰‡..."  â”‚â”‚
â”‚  â”‚ <json>    â”‚                       â”‚ "âœ… ç”Ÿæˆå®Œæˆ!"       â”‚â”‚
â”‚  â”‚ {...}    â”‚                       â”‚                      â”‚â”‚
â”‚  â”‚ </json>  â”‚                       â”‚ â†’ æ¸²æŸ“ç»„ä»¶æ ‘         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4.3 åç«¯å®ç°

```typescript
// server/routes/generateStream.ts
import { Response } from "express";

app.get("/api/generate-page-stream", async (req, res: Response) => {
  // è®¾ç½® SSE å“åº”å¤´
  res.setHeader("Content-Type", "text/event-stream");
  res.setHeader("Cache-Control", "no-cache");
  res.setHeader("Connection", "keep-alive");

  const sendEvent = (type: string, data: any) => {
    res.write(`event: ${type}\n`);
    res.write(`data: ${JSON.stringify(data)}\n\n`);
  };

  try {
    // Phase 1: æ„å›¾åˆ†æ
    sendEvent("phase", { phase: "intent", message: "ğŸ§  åˆ†æç”¨æˆ·æ„å›¾..." });
    const intent = await intentChain.invoke(query);
    sendEvent("intent", intent);

    // Phase 2: è®¾è®¡é“¾
    sendEvent("phase", { phase: "design", message: "ğŸ¨ ç”Ÿæˆè®¾è®¡æ–¹æ¡ˆ..." });
    const design = await designChain.invoke(intent);
    sendEvent("design", design);

    // Phase 3: Schema ç”Ÿæˆ (æµå¼)
    sendEvent("phase", { phase: "schema", message: "ğŸ—ï¸ æ„å»ºé¡µé¢ç»“æ„..." });

    const stream = await schemaModel.stream(schemaPrompt);
    let thinkingBuffer = "";
    let isInThinking = false;

    for await (const chunk of stream) {
      const text = chunk.content as string;

      // æ£€æµ‹ <thinking> åŒºåŸŸ
      if (text.includes("<thinking>")) isInThinking = true;
      if (isInThinking) {
        thinkingBuffer += text;
        // å®æ—¶æ¨é€æ€è€ƒå†…å®¹
        sendEvent("thinking", { content: text });
      }
      if (text.includes("</thinking>")) isInThinking = false;
    }

    // è§£ææœ€ç»ˆ JSON
    const json = await extractJson(fullResponse);
    sendEvent("schema", json);
    sendEvent("complete", { success: true });
  } catch (error) {
    sendEvent("error", { message: error.message });
  } finally {
    res.end();
  }
});
```

#### 3.4.4 å‰ç«¯å®ç°

```typescript
// src/editor/stores/aiPageDesigner.tsx
function generateWithStream(text: string) {
  const eventSource = new EventSource(
    `/api/generate-page-stream?text=${encodeURIComponent(text)}`
  );

  eventSource.addEventListener("thinking", (e) => {
    const data = JSON.parse(e.data);
    setThinkingText((prev) => prev + data.content);
  });

  eventSource.addEventListener("phase", (e) => {
    const data = JSON.parse(e.data);
    setCurrentPhase(data.phase);
    setStatusMessage(data.message);
  });

  eventSource.addEventListener("schema", (e) => {
    const schema = JSON.parse(e.data);
    applySchemaToCanvas(schema);
  });

  eventSource.addEventListener("error", () => {
    eventSource.close();
    setError("ç”Ÿæˆå¤±è´¥");
  });
}
```

---

### 3.5 å¢å¼ºç‰©æ–™å…ƒæ•°æ®æ¨¡å— (v2.1 æ–°å¢)

> âš ï¸ **æ¶æ„è¯„å®¡å¿…ä¿®é¡¹ #2**: è§£å†³ "GitHub ä¾§è¾¹æ " åŒ¹é…ä¸åˆ° Grid çš„é—®é¢˜

#### 3.5.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: å‘é‡åŒ–åªç”¨ `name + desc`ï¼Œè¯­ä¹‰å¤ªçª„ã€‚

```typescript
// âŒ å½“å‰å‘é‡åŒ–æ–‡æœ¬
"Grid: æ …æ ¼å¸ƒå±€ç»„ä»¶";
// ç”¨æˆ·è¯´ "GitHub å·¦è¾¹é‚£ä¸€æ "ï¼ŒåŒ¹é…ä¸åˆ°
```

#### 3.5.2 è§£å†³æ–¹æ¡ˆï¼šåœºæ™¯åŒ–æè¿°æ³¨å…¥

```typescript
// âœ… å¢å¼ºåçš„å‘é‡åŒ–æ–‡æœ¬
{
  name: "Grid",
  desc: "æ …æ ¼å¸ƒå±€ç»„ä»¶",
  usage_context: "åˆ†æ å¸ƒå±€ã€ä¸¤æ å¸ƒå±€ã€ä¸‰æ å¸ƒå±€ã€ä¾§è¾¹æ ã€å·¦ä¾§å¯¼èˆªã€GitHubé£æ ¼å¸ƒå±€",
  keywords: ["column", "åˆ†æ ", "sidebar", "ä¾§è¾¹æ ", "å·¦å³ç»“æ„", "å“åº”å¼"]
}
// å‘é‡åŒ–: `${name}: ${desc}. ä½¿ç”¨åœºæ™¯: ${usage_context}. å…³é”®è¯: ${keywords.join(', ')}`
```

#### 3.5.3 ç‰©æ–™å¢å¼ºè„šæœ¬

```typescript
// scripts/enrich-materials.ts
import { ChatOpenAI } from "@langchain/openai";
import materials from "../server/template/materials-ai.json";

const enrichPrompt = `
ä½ æ˜¯ä¸€ä¸ª UI ç»„ä»¶ä¸“å®¶ã€‚ç»™å®šä»¥ä¸‹ç»„ä»¶ä¿¡æ¯ï¼Œè¯·ç”Ÿæˆï¼š
1. usage_context: è¯¥ç»„ä»¶å¸¸è§çš„ä½¿ç”¨åœºæ™¯æè¿°ï¼ˆ100å­—ä»¥å†…ï¼‰
2. keywords: 5-10 ä¸ªç›¸å…³å…³é”®è¯ï¼ˆåŒ…å«ä¸­è‹±æ–‡ï¼‰

ç»„ä»¶å: {{name}}
ç»„ä»¶æè¿°: {{desc}}
ç»„ä»¶å±æ€§: {{props}}

è¾“å‡º JSON:
{ "usage_context": "...", "keywords": [...] }
`;

async function enrichMaterials() {
  const model = new ChatOpenAI({ model: "gpt-4o-mini", temperature: 0.3 });

  for (const material of materials) {
    const prompt = enrichPrompt
      .replace("{{name}}", material.name)
      .replace("{{desc}}", material.desc)
      .replace("{{props}}", JSON.stringify(material.props?.slice(0, 5)));

    const response = await model.invoke(prompt);
    const enriched = JSON.parse(response.content);

    material.usage_context = enriched.usage_context;
    material.keywords = enriched.keywords;
  }

  writeFileSync(
    "server/template/materials-enriched.json",
    JSON.stringify(materials, null, 2)
  );
}
```

#### 3.5.4 å¢å¼ºåçš„å‘é‡åŒ–

```typescript
// scripts/embed-materials.ts
function buildEmbeddingText(material: Material): string {
  return [
    `${material.name}: ${material.desc}`,
    `ä½¿ç”¨åœºæ™¯: ${material.usage_context}`,
    `å…³é”®è¯: ${material.keywords?.join(", ")}`,
    `å±æ€§: ${material.props?.map((p) => p.name).join(", ")}`,
  ].join(". ");
}

// ç¤ºä¾‹è¾“å‡º:
// "Grid: æ …æ ¼å¸ƒå±€ç»„ä»¶. ä½¿ç”¨åœºæ™¯: åˆ†æ å¸ƒå±€ã€ä¾§è¾¹æ ã€å“åº”å¼ç½‘æ ¼. å…³é”®è¯: column, sidebar, ä¸¤æ , ä¸‰æ ..."
```

---

### 3.6 é²æ£’ JSON è§£æå™¨æ¨¡å— (v2.1 æ–°å¢)

> âš ï¸ **æ¶æ„è¯„å®¡å¿…ä¿®é¡¹ #3**: è§£å†³æ­£åˆ™è§£æçš„è„†å¼±æ€§

#### 3.6.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: ç®€å•æ­£åˆ™æ— æ³•å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚

````typescript
// âŒ è„†å¼±çš„æ­£åˆ™
const match = content.match(/<json>([\s\S]*?)<\/json>/);
// å¤±è´¥åœºæ™¯:
// 1. åµŒå¥—æ ‡ç­¾: <json>{ "content": "<json>" }</json>
// 2. æ— é—­åˆæ ‡ç­¾: <json>{ "name": "Page"... (token æˆªæ–­)
// 3. Markdown æ ¼å¼: ```json\n{...}\n```
````

#### 3.6.2 è§£å†³æ–¹æ¡ˆï¼šå¤šç­–ç•¥è§£æå™¨

````typescript
// server/utils/extractJson.ts
import { jsonrepair } from "jsonrepair";

interface ExtractResult {
  json: any;
  thinking: string;
  method: "xml" | "markdown" | "raw" | "repaired";
}

export function extractJson(content: string): ExtractResult {
  let thinking = "";
  let jsonStr = "";
  let method: ExtractResult["method"] = "raw";

  // 1. æå– <thinking> (å¦‚æœå­˜åœ¨)
  const thinkingMatch = content.match(/<thinking>([\s\S]*?)<\/thinking>/);
  if (thinkingMatch) {
    thinking = thinkingMatch[1].trim();
  }

  // 2. ç­–ç•¥ A: XML æ ‡ç­¾ (ä¼˜å…ˆ)
  const xmlMatch = content.match(/<json>([\s\S]*?)(?:<\/json>|$)/);
  if (xmlMatch) {
    jsonStr = xmlMatch[1].trim();
    method = "xml";
  }

  // 3. ç­–ç•¥ B: Markdown ä»£ç å—
  if (!jsonStr) {
    const mdMatch = content.match(/```(?:json)?\s*([\s\S]*?)(?:```|$)/);
    if (mdMatch) {
      jsonStr = mdMatch[1].trim();
      method = "markdown";
    }
  }

  // 4. ç­–ç•¥ C: ç›´æ¥æŸ¥æ‰¾ JSON å¯¹è±¡
  if (!jsonStr) {
    const rawMatch = content.match(/\{[\s\S]*\}/);
    if (rawMatch) {
      jsonStr = rawMatch[0];
      method = "raw";
    }
  }

  if (!jsonStr) {
    throw new Error("æ— æ³•ä»å“åº”ä¸­æå– JSON");
  }

  // 5. å°è¯•è§£æ
  try {
    return { json: JSON.parse(jsonStr), thinking, method };
  } catch (e) {
    // 6. ä½¿ç”¨ jsonrepair æŠ¢æ•‘
    try {
      const repaired = jsonrepair(jsonStr);
      return { json: JSON.parse(repaired), thinking, method: "repaired" };
    } catch (e2) {
      throw new Error(`JSON è§£æå¤±è´¥: ${e2.message}`);
    }
  }
}
````

#### 3.6.3 æµ‹è¯•ç”¨ä¾‹

````typescript
// server/utils/__tests__/extractJson.test.ts
describe("extractJson", () => {
  it("handles XML tags", () => {
    const input = `<thinking>åˆ†æä¸­</thinking>\n<json>{"name":"Page"}</json>`;
    expect(extractJson(input).json.name).toBe("Page");
  });

  it("handles Markdown code blocks", () => {
    const input = '```json\n{"name":"Page"}\n```';
    expect(extractJson(input).json.name).toBe("Page");
  });

  it("handles truncated XML (no closing tag)", () => {
    const input = `<json>{"name":"Page","children":[`;
    const result = extractJson(input);
    expect(result.method).toBe("repaired");
  });

  it("handles nested json string in content", () => {
    const input = `<json>{"content":"<json>test</json>"}</json>`;
    expect(extractJson(input).json.content).toBe("<json>test</json>");
  });
});
````

---

### 3.7 è¯„ä¼°ç®¡é“æ¨¡å—

#### 3.4.1 è®¾è®¡åŠ¨æœº

**é—®é¢˜**: æ— æ³•é‡åŒ– Prompt è°ƒæ•´æ•ˆæœï¼Œå‡­æ„Ÿè§‰å¼€å‘ã€‚

**ä¼ä¸šçº§è¦æ±‚**: æ¯æ¬¡å˜æ›´æœ‰æ•°æ®æ”¯æ’‘ã€‚

#### 3.4.2 è¯„ä¼°æŒ‡æ ‡ä½“ç³»

```typescript
interface EvaluationMetrics {
  // è¯­æ³•å±‚é¢
  jsonValidRate: number; // JSON è§£ææˆåŠŸç‡
  schemaValidRate: number; // Schema ç»“æ„åˆæ³•ç‡

  // è¯­ä¹‰å±‚é¢
  componentRecall: number; // æœŸæœ›ç»„ä»¶å¬å›ç‡
  componentPrecision: number; // ç»„ä»¶å‡†ç¡®ç‡ï¼ˆæ— å¤šä½™ï¼‰

  // è§†è§‰å±‚é¢
  styleCompleteness: number; // æ ·å¼å®Œæ•´åº¦
  layoutCorrectness: number; // å¸ƒå±€æ­£ç¡®ç‡ï¼ˆäººå·¥æ ‡æ³¨ï¼‰

  // æ•ˆç‡å±‚é¢
  avgLatencyMs: number; // å¹³å‡å»¶è¿Ÿ
  avgRetryCount: number; // å¹³å‡é‡è¯•æ¬¡æ•°
  avgTokenUsage: number; // å¹³å‡ Token æ¶ˆè€—
}
```

#### 3.4.3 æ•°æ®é›†ç»“æ„

```
server/evaluation/
â”œâ”€â”€ dataset/
â”‚   â”œâ”€â”€ cases/
â”‚   â”‚   â”œâ”€â”€ login-simple.json
â”‚   â”‚   â”œâ”€â”€ login-with-oauth.json
â”‚   â”‚   â”œâ”€â”€ dashboard-basic.json
â”‚   â”‚   â”œâ”€â”€ dashboard-complex.json
â”‚   â”‚   â”œâ”€â”€ form-single-column.json
â”‚   â”‚   â”œâ”€â”€ form-two-column.json
â”‚   â”‚   â””â”€â”€ list-with-filter.json
â”‚   â””â”€â”€ golden/
â”‚       â””â”€â”€ expected-schemas/
â”œâ”€â”€ metrics.ts
â”œâ”€â”€ runner.ts
â””â”€â”€ report.ts
```

#### 3.4.4 è‡ªåŠ¨åŒ–è¯„ä¼°æµç¨‹

```typescript
// server/evaluation/runner.ts
export async function runEvaluation(config: EvalConfig): Promise<EvalReport> {
  const results: TestResult[] = [];

  for (const testCase of loadTestCases()) {
    const startTime = Date.now();

    try {
      const schema = await generatePage(testCase.input);
      const metrics = evaluateSchema(schema, testCase.expected);

      results.push({
        id: testCase.id,
        success: true,
        metrics,
        latencyMs: Date.now() - startTime,
      });
    } catch (error) {
      results.push({
        id: testCase.id,
        success: false,
        error: error.message,
      });
    }
  }

  return generateReport(results);
}
```

---

## 4. æ•°æ®æµè®¾è®¡

### 4.1 å®Œæ•´è¯·æ±‚æµç¨‹

```
ç”¨æˆ·è¾“å…¥: "ä¸€ä¸ªç™»å½•é¡µé¢"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 1: æ„å›¾åˆ†æ                                                 â”‚
â”‚                                                                 â”‚
â”‚ è¾“å…¥:   "ä¸€ä¸ªç™»å½•é¡µé¢"                                          â”‚
â”‚ æ¨¡å‹:   gpt-4o-mini (temp=0.3)                                  â”‚
â”‚ è¾“å‡º:   { layoutType: "Form", suggestedComponents: [...] }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RAG: ç‰©æ–™æ£€ç´¢                                                   â”‚
â”‚                                                                 â”‚
â”‚ æŸ¥è¯¢:   "ç™»å½•é¡µé¢" + intent.description                         â”‚
â”‚ æ–¹æ³•:   è¯­ä¹‰æœç´¢ (LanceDB)                                      â”‚
â”‚ è¾“å‡º:   [Form, FormItem, Input, Button, Container, ...]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 2: è®¾è®¡é“¾                                                   â”‚
â”‚                                                                 â”‚
â”‚ è¾“å…¥:   æ„å›¾ + æ£€ç´¢åˆ°çš„ç‰©æ–™                                     â”‚
â”‚ æ¨¡å‹:   gpt-4o-mini (temp=0.4)                                  â”‚
â”‚ è¾“å‡º:   { layoutStrategy, colorScheme, typography, ... }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ 3: Schema ç”Ÿæˆ (CoT åˆ†ç¦»)                                   â”‚
â”‚                                                                 â”‚
â”‚ è¾“å…¥:   æ„å›¾ + è®¾è®¡ + ç‰©æ–™                                      â”‚
â”‚ æ¨¡å‹:   gpt-4o-mini (temp=0.1)                                  â”‚
â”‚ è¾“å‡º:   <thinking>...</thinking> <json>...</json>               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯ + è‡ªæˆ‘ä¿®æ­£å¾ªç¯                                              â”‚
â”‚                                                                 â”‚
â”‚ 1. è§£æ <json> å†…å®¹                                             â”‚
â”‚ 2. JSON.parse + jsonrepair å®¹é”™                                 â”‚
â”‚ 3. Linter ç»“æ„éªŒè¯                                              â”‚
â”‚ 4. å¦‚æœé”™è¯¯ && å°è¯•æ¬¡æ•° < 3 â†’ å¸¦é”™è¯¯ä¿¡æ¯é‡è¯•                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å‡º: æœ€ç»ˆç»„ä»¶æ ‘                                                 â”‚
â”‚                                                                 â”‚
â”‚ {                                                               â”‚
â”‚   "id": 1,                                                      â”‚
â”‚   "name": "Page",                                               â”‚
â”‚   "styles": { "backgroundColor": "#f5f5f5" },                  â”‚
â”‚   "children": [...]                                             â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æŠ€æœ¯é€‰å‹

### 5.1 ä¾èµ–çŸ©é˜µ

| åŠŸèƒ½        | åº“/æœåŠ¡             | ç‰ˆæœ¬ | ç”¨é€”            |
| ----------- | ------------------- | ---- | --------------- |
| Embeddings  | `@langchain/openai` | ^1.0 | æ–‡æœ¬å‘é‡åŒ–      |
| Vector DB   | `@lancedb/lancedb`  | ^0.4 | æœ¬åœ°å‘é‡å­˜å‚¨    |
| JSON Repair | `jsonrepair`        | ^3.0 | ä¿®å¤æŸå JSON   |
| Tracing     | `langsmith`         | ^0.1 | è¯·æ±‚è¿½è¸ª (å¯é€‰) |

### 5.2 æ¨¡å‹é…ç½®

| é˜¶æ®µ      | æ¨¡å‹                   | Temperature | ç”¨é€”       |
| --------- | ---------------------- | ----------- | ---------- |
| Intent    | gpt-4o-mini            | 0.3         | æ„å›¾è¯†åˆ«   |
| Design    | gpt-4o-mini            | 0.4         | è®¾è®¡åˆ›æ„   |
| Schema    | gpt-4o-mini            | 0.1         | ç»“æ„ç”Ÿæˆ   |
| Embedding | text-embedding-3-small | -           | è¯­ä¹‰å‘é‡åŒ– |

---

## 6. ç›®å½•ç»“æ„

```
server/
â”œâ”€â”€ index.ts                 # ä¸»å…¥å£ (é‡æ„)
â”œâ”€â”€ REFACTORING_PLAN.md      # é‡æ„è®¡åˆ’
â”œâ”€â”€ ARCHITECTURE.md          # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ chains/                  # LangChain å°è£…
â”‚   â”œâ”€â”€ intentChain.ts
â”‚   â”œâ”€â”€ designChain.ts
â”‚   â””â”€â”€ schemaChain.ts
â”‚
â”œâ”€â”€ rag/                     # è¯­ä¹‰æ£€ç´¢
â”‚   â”œâ”€â”€ embeddings.ts
â”‚   â”œâ”€â”€ vectorStore.ts
â”‚   â””â”€â”€ retriever.ts
â”‚
â”œâ”€â”€ validation/              # éªŒè¯ä¸ä¿®æ­£
â”‚   â”œâ”€â”€ jsonParser.ts
â”‚   â”œâ”€â”€ schemaValidator.ts
â”‚   â””â”€â”€ retryLoop.ts
â”‚
â”œâ”€â”€ prompts/                 # Prompt æ¨¡æ¿
â”‚   â”œâ”€â”€ intent_system.md
â”‚   â”œâ”€â”€ design_system.md
â”‚   â”œâ”€â”€ schema_system_template.md
â”‚   â””â”€â”€ examples/            # Few-shot ç¤ºä¾‹
â”‚       â”œâ”€â”€ login.md
â”‚       â”œâ”€â”€ dashboard.md
â”‚       â””â”€â”€ form.md
â”‚
â”œâ”€â”€ evaluation/              # è¯„ä¼°ç³»ç»Ÿ
â”‚   â”œâ”€â”€ dataset/
â”‚   â”œâ”€â”€ metrics.ts
â”‚   â”œâ”€â”€ runner.ts
â”‚   â””â”€â”€ report.ts
â”‚
â”œâ”€â”€ linter.ts                # ç»“æ„ä¿®æ­£å™¨
â”œâ”€â”€ schemas.ts               # ç±»å‹å®šä¹‰
â”‚
â””â”€â”€ template/                # é™æ€èµ„æº
    â”œâ”€â”€ materials-ai.json
    â””â”€â”€ component-names.json
```

---

## 7. é£é™©ä¸ç¼“è§£

| é£é™©               | å½±å“     | ç¼“è§£æªæ–½            |
| ------------------ | -------- | ------------------- |
| å‘é‡åº“å¢åŠ å»¶è¿Ÿ     | å“åº”å˜æ…¢ | é¢„çƒ­ + ç¼“å­˜         |
| é‡è¯•å¾ªç¯æ­»å¾ªç¯     | èµ„æºè€—å°½ | ç¡¬æ€§ä¸Šé™ (3æ¬¡)      |
| Embedding API æˆæœ¬ | é¢„ç®—è¶…æ”¯ | æ‰¹é‡å¤„ç† + æœ¬åœ°ç¼“å­˜ |
| è¯„ä¼°æ•°æ®é›†åå·®     | è¯¯åˆ¤æ•ˆæœ | æŒç»­æ‰©å…… + å¤šæ ·åŒ–   |

---

## 8. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³**: é˜…è¯»å¹¶æ‰¹å‡†æœ¬æ¶æ„è®¾è®¡
2. **Week 1**: å®æ–½ Phase 1-2 (Prompt + RAG)
3. **Week 2**: å®æ–½ Phase 3-4 (Retry + Eval)
4. **Week 3**: é›†æˆæµ‹è¯• + æ€§èƒ½ä¼˜åŒ–

---

_æ–‡æ¡£ç»“æŸ_
